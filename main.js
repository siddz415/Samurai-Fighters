(()=>{kaboom({width:1280,height:720,scale:1,stretch:!0,debug:!1});loadSprite("background","assets/background/background_layer_1.png");loadSprite("trees","assets/background/background_layer_2.png");loadSpriteAtlas("assets/oak_woods_tileset.png",{"ground-golden":{x:16,y:0,width:16,height:16},"deep-ground":{x:16,y:32,width:16,height:16},"ground-silver":{x:150,y:0,width:16,height:16}});loadSprite("shop","assets/shop_anim.png",{sliceX:6,sliceY:1,anims:{default:{from:0,to:5,speed:12,loop:!0}}});loadSprite("fence","assets/fence_1.png");loadSprite("sign","assets/sign.png");loadSprite("idle-player1","assets/idle-player1.png",{sliceX:8,sliceY:1,anims:{idle:{from:0,to:7,speed:12,loop:!0}}});loadSprite("jump-player1","assets/jump-player1.png",{sliceX:2,sliceY:1,anims:{jump:{from:0,to:1,speed:2,loop:!0}}});loadSprite("attack-player1","assets/attack-player1.png",{sliceX:6,sliceY:1,anims:{attack:{from:1,to:5,speed:18}}});loadSprite("run-player1","assets/run-player1.png",{sliceX:8,sliceY:1,anims:{run:{from:0,to:7,speed:18}}});loadSprite("death-player1","assets/death-player1.png",{sliceX:6,sliceY:1,anims:{death:{from:0,to:5,speed:10}}});loadSprite("idle-player2","assets/idle-player2.png",{sliceX:4,sliceY:1,anims:{idle:{from:0,to:3,speed:8,loop:!0}}});loadSprite("jump-player2","assets/jump-player2.png",{sliceX:2,sliceY:1,anims:{jump:{from:0,to:1,speed:2,loop:!0}}});loadSprite("attack-player2","assets/attack-player2.png",{sliceX:4,sliceY:1,anims:{attack:{from:0,to:3,speed:18}}});loadSprite("run-player2","assets/run-player2.png",{sliceX:8,sliceY:1,anims:{run:{from:0,to:7,speed:18}}});loadSprite("death-player2","assets/death-player2.png",{sliceX:7,sliceY:1,anims:{death:{from:0,to:6,speed:10}}});scene("fight",()=>{let n=add([sprite("background"),scale(4)]);n.add([sprite("trees")]),addLevel(["","","","","","","","","","------#######-----------","dddddddddddddddddddddddd","dddddddddddddddddddddddd"],{tileWidth:16,tileHeight:16,tiles:{"#":()=>[sprite("ground-golden"),area(),body({isStatic:!0})],"-":()=>[sprite("ground-silver"),area(),body({isStatic:!0})],d:()=>[sprite("deep-ground"),area(),body({isStatic:!0})]}}).use(scale(4)),n.add([sprite("shop"),pos(170,15)]).play("default"),add([rect(16,720),area(),body({isStatic:!0}),pos(-20,0)]),add([rect(16,720),area(),body({isStatic:!0}),pos(1280,0)]),n.add([sprite("fence"),pos(85,125)]),n.add([sprite("fence"),pos(10,125)]),n.add([sprite("sign"),pos(290,115)]);function m(e,a,i,l,g,r){return add([pos(e,a),scale(g),area({shape:new Rect(vec2(0),i,l)}),anchor("center"),body({stickToPlatform:!0}),{isCurrentlyJumping:!1,health:500,sprites:{run:"run-"+r,idle:"idle-"+r,jump:"jump-"+r,attack:"attack-"+r,death:"death-"+r}}])}setGravity(1200);let s=m(200,100,16,42,4,"player1");s.use(sprite(s.sprites.idle)),s.play("idle");function p(e,a,i){e.health!==0&&(e.curAnim()!=="run"&&!e.isCurrentlyJumping&&(e.use(sprite(e.sprites.run)),e.play("run")),e.move(a,0),e.flipX=i)}function o(e){e.use(sprite(e.sprites.idle)),e.play("idle")}onKeyDown("d",()=>{p(s,500,!1)}),onKeyRelease("d",()=>{s.health!==0&&(o(s),s.flipX=!1)}),onKeyDown("a",()=>{p(s,-500,!0)}),onKeyRelease("a",()=>{s.health!==0&&(o(s),s.flipX=!0)});function y(e){if(e.health!==0&&e.isGrounded()){let a=e.flipX;e.jump(),e.use(sprite(e.sprites.jump)),e.flipX=a,e.play("jump"),e.isCurrentlyJumping=!0}}function k(e){e.isGrounded()&&e.isCurrentlyJumping&&(e.isCurrentlyJumping=!1,e.curAnim()!=="idle"&&o(e))}onKeyDown("w",()=>{y(s)}),s.onUpdate(()=>k(s));function w(e,a){if(e.health===0)return;for(let l of a)if(isKeyDown(l))return;let i=e.flipX;if(e.curAnim()!=="attack"){e.use(sprite(e.sprites.attack)),e.flipX=i;let l=e.pos.x+30,g=e.pos.x-350,r=e.pos.y-200;add([rect(300,300),area(),pos(i?g:l,r),opacity(0),e.id+"attackHitbox"]),e.play("attack",{onEnd:()=>{o(e),e.flipX=i}})}}onKeyPress("space",()=>{w(s,["a","d","w"])}),onKeyRelease("space",()=>{destroyAll(s.id+"attackHitbox")});let t=m(1e3,200,16,52,4,"player2");t.use(sprite(t.sprites.idle)),t.play("idle"),t.flipX=!0,onKeyDown("right",()=>{p(t,500,!1)}),onKeyRelease("right",()=>{t.health!==0&&(o(t),t.flipX=!1)}),onKeyDown("left",()=>{p(t,-500,!0)}),onKeyRelease("left",()=>{t.health!==0&&(o(t),t.flipX=!0)}),onKeyDown("up",()=>{y(t)}),t.onUpdate(()=>k(t)),onKeyPress("down",()=>{w(t,["left","right","up"])}),onKeyRelease("down",()=>{destroyAll(t.id+"attackHitbox")});let c=add([rect(100,100),pos(center().x,center().y-300),color(10,10,10),area(),anchor("center")]).add([text("60"),area(),anchor("center"),{timeLeft:60}]),u=add([text(""),area(),anchor("center"),pos(center())]),d=!1;onKeyDown("enter",()=>d?go("fight"):null);function h(e,a,i){a.health>0&&i.health>0||a.health===0&&i.health===0?e.text="Tie!":a.health>0&&i.health===0?(e.text="Player 1 won!",i.use(sprite(i.sprites.death)),i.play("death")):(e.text="Player 2 won!",a.use(sprite(a.sprites.death)),a.play("death"))}let f=setInterval(()=>{if(c.timeLeft===0){clearInterval(f),h(u,s,t),d=!0;return}c.timeLeft--,c.text=c.timeLeft},1e3),X=add([rect(500,70),area(),outline(5),pos(90,20),color(200,0,0)]).add([rect(498,65),color(0,180,0),pos(498,70-2.5),rotate(180)]);s.onCollide(t.id+"attackHitbox",()=>{d||(s.health!==0&&(s.health-=50,tween(X.width,s.health,1,e=>{X.width=e},easings.easeOutSine)),s.health===0&&(clearInterval(f),h(u,s,t),d=!0))});let S=add([rect(500,70),area(),outline(5),pos(690,20),color(200,0,0)]).add([rect(498,65),color(0,180,0),pos(2.5,2.5)]);t.onCollide(s.id+"attackHitbox",()=>{d||(t.health!==0&&(t.health-=50,tween(S.width,t.health,1,e=>{S.width=e},easings.easeOutSine)),t.health===0&&(clearInterval(f),h(u,s,t),d=!0))})});go("fight");})();
